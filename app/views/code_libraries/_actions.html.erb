<!-- app/views/code_libraries/_actions.html.erb -->
<%# locals: pre_code:, current_like:, current_bookmark: %>

<%# === 呼び出し側が渡し忘れても落ちない & なるべく正確に表示する === %>
<% current_like     = local_assigns.fetch(:current_like, nil) %>
<% current_bookmark = local_assigns.fetch(:current_bookmark, nil) %>
<% if logged_in? %>
  <% current_like     ||= pre_code.likes.find_by(user_id: current_user.id) %>
  <% current_bookmark ||= pre_code.bookmarks.find_by(user_id: current_user.id) %>
<% end %>

<div id="<%= dom_id(pre_code, :actions) %>" class="flex gap-2">
  <% if logged_in? %>
    <%# === いいね === %>
    <% if current_like %>
      <%= button_to like_path(current_like),
          method: :delete,
          form: { data: { turbo_stream: true } },
          class: "px-3 py-1 rounded bg-rose-600 text-white inline-flex items-center gap-1" do %>
        <%= heroicon "heart", variant: :solid, options: { class: "w-4 h-4" } %>
        <%= pre_code.like_count %>
      <% end %>
    <% else %>
      <%= button_to likes_path(pre_code_id: pre_code.id),
          method: :post,
          form: { data: { turbo_stream: true } },
          class: "px-3 py-1 rounded ring-1 ring-slate-300 inline-flex items-center gap-1" do %>
        <%= heroicon "heart", variant: :outline, options: { class: "w-4 h-4" } %>
        <%= pre_code.like_count %>
      <% end %>
    <% end %>

    <%# === ブックマーク === %>
    <% if current_bookmark %>
      <%= button_to bookmark_path(current_bookmark),
          method: :delete,
          form: { data: { turbo_stream: true } },
          class: "px-3 py-1 rounded bg-blue-600 text-white inline-flex items-center gap-1" do %>
        <%= heroicon "bookmark", variant: :solid, options: { class: "w-4 h-4" } %>
        保存済み
      <% end %>
    <% else %>
      <%= button_to bookmarks_path(pre_code_id: pre_code.id),
          method: :post,
          form: { data: { turbo_stream: true } },
          class: "px-3 py-1 rounded ring-1 ring-slate-300 inline-flex items-center gap-1" do %>
        <%= heroicon "bookmark", variant: :outline, options: { class: "w-4 h-4" } %>
        ブックマーク
      <% end %>
    <% end %>
  <% end %>
</div>
