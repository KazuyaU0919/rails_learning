<!-- =========================================================
  Page: My PreCodes 一覧画面
  ---------------------------------------------------------
  ・自分の登録した PreCode 一覧を表示
  ・検索フォーム、タグ絞り込み、新規作成導線を含む
  ・初回利用者向けの説明セクションあり
========================================================= -->

<% breadcrumb :pre_codes %>
<%= render "shared/breadcrumbs" %>
<% content_for :title, "My PreCodes" %>

<!-- =========================================================
     ヘッダー：タイトル + 説明 + 検索エリア
========================================================= -->
<div class="mb-6">

  <!-- =======================
       タイトル部
  ======================= -->
  <div class="text-center">
    <h1 class="text-2xl font-semibold">My PreCodes</h1>
    <p class="mt-1 text-sm text-slate-500">~ 初期データ登録機能 ~</p>
  </div>

  <!-- =======================
       🔰 初めての方へ（折りたたみ説明）
  ======================= -->
  <section
    class="-mt-2 mb-2"
    data-controller="reveal"
    data-reveal-open-label-value="🔰 初めての方へ"
    data-reveal-close-label-value="🔰 説明を閉じる">
    <div class="flex justify-end">
      <button type="button"
              class="btn-toggle"
              data-reveal-target="button"
              data-action="reveal#toggle">🔰 初めての方へ</button>
    </div>

    <!-- 説明本文 -->
    <div class="hidden mt-2" data-reveal-target="content">
      <pre class="whitespace-pre-wrap leading-relaxed text-slate-700 bg-white ring-1 ring-slate-200 rounded-lg p-4 text-[15px]">
🎨 PreCode機能へようこそ！！
PreCodeは、自分のための初期データを作成する機能です。


【初期データって何？？】

初期データとは、コードエディタのエディタフォームに
あらかじめ登録しておいたコード断片（スニペット）を自動入力する機能です。

といっても、言葉で説明しても分かりづらいと思うので、
以下で例え話を例にして説明していきますね！


たとえば、Rubyの標準メソッドに「min」ってメソッドがありますよね。

以下のような配列numbersがあった時、
その配列の中の最小値「４」を抽出するコードです。

==================例題コード======================

numbers = [42, 7, 19, 73, 4, 58, 91, 26, 11, 65]

puts numbers.min
# => 4

================================================


この「min」について、
コードエディタを用いた実践的な学習をしたいと思った時、
毎回初期データとして、配列numbersを用意しないといけません。

上記のように配列numbersを定義してからでないと、
numbers.minの意味が通らなくなってしまいます。


でも、毎回配列numbersを定義するのって、
めんどくさくないですか？？

まぁ、上記の配列numbersくらいなら良いかもしれませんが、
別のRuby標準メソッドを試すために、
もっとややこしく、コード量も多い初期データが必要ならどうでしょうか？

そのメソッドを試すために、
毎回その初期データを入力しないといけないとしたらどうですか？？

少なくとも私はめんどくさいと思います。

なので、普段よく利用する初期データを登録・保存しておいて、
「コードエディタでRuby標準メソッドの復習をするときに楽をしよう！」
という考えのもと生み出されたのが初期データ登録機能、
つまり、PreCode機能です。



【PreCode機能の使い方】

PreCodeを作成したい場合は、
「PreCode 新規作成」ボタンを押してください。

PreCode新規作成画面では、
PreCodeの登録名・検索タグ・コードについての説明・登録コードの入力欄があります。

自分が普段利用する初期データ（コード断片）を登録してみましょう！

※ 作成した初期データは、Code Library機能で全ユーザーが閲覧・利用できるので、
　個人情報やモラルに反するような内容は登録しないようにしましょう。



【問題モードについて】

新規作成画面や編集画面の画面右上にある
「問題モードにする」ボタンを押すと問題モードになり、
通常モードの入力欄に加えて、「ヒント」・「解答」・「解答コード」の３つの入力欄が追加されます。

この問題モードを使うことで、
簡易的なRubyのクイズを作ることができ、
Ruby標準メソッドなどの復習に利用することができます。



【その他】

Code Library機能では、
他ユーザーの作成した初期データやクイズを閲覧・利用することができます。

PreCode機能の詳細画面では、
作成した初期データを閲覧することができ、
さらに、Xでシェアしたり、作成した初期データのURLを友人に共有することもできます。

※ 「URLコピー」ボタンは、作成した初期データのURLを友人に共有するためのボタンなので、
　Code Libraryへ遷移するURLになっております（つまり、自分ではそのURLを利用できません）。

※ ❤️は他ユーザーからのいいね数、💼は他ユーザーが該当の初期データを利用した数です。


これらの機能を利用して、
Rubyの標準メソッドを効率的に学習しましょう！
      </pre>
    </div>
  </section>

  <!-- =======================
       検索・フィルタ・新規作成ボタン群
  ======================= -->
  <div class="mt-4">
    <!-- 🔍 検索フォーム -->
    <div class="flex gap-2 justify-end">
      <%= search_form_for @q, url: pre_codes_path, method: :get,
            html: { class: "flex gap-2" } do |f| %>

        <div data-controller="autocomplete"
             data-autocomplete-list-url-value="<%= pre_codes_path %>"
             data-autocomplete-sort-value="<%= (params[:sort].presence || 'id_desc') %>">

          <%= f.search_field :title_or_description_cont,
                value: @q.title_or_description_cont,
                placeholder: "検索（タイトル／説明）",
                class: "px-3 py-2 rounded ring-1 ring-slate-300 w-64",
                data: {
                  autocomplete_target: "input",
                  action: "input->autocomplete#onInput focus->autocomplete#onFocus blur->autocomplete#onBlur"
                } %>

          <div data-autocomplete-target="panel"
               class="hidden mt-1 w-full max-w-[20rem] rounded border border-slate-200 bg-white shadow-md"></div>
        </div>

        <%= f.submit "検索", class: "btn-solid-red" %>
      <% end %>
    </div>

    <!-- 🏷️ タグフィルタ -->
    <div class="flex mt-2 justify-end">
      <%= render "shared/tag_filter" %>
    </div>

    <!-- ➕ 操作ボタン群（右寄せ） -->
    <div class="flex gap-2 mt-2 justify-end">
      <%= link_to "使い方", help_path, class: "btn-solid-red" %>
      <%= link_to "PreCode 新規作成", new_pre_code_path, class: "btn-solid-red" %>
    </div>
  </div>
</div>

<!-- =========================================================
     一覧表示エリア
========================================================= -->
<% if @pre_codes.blank? %>
  <!-- データなし -->
  <p class="text-slate-500">まだ登録がありません。まずは「新規作成」からはじめましょう。</p>
<% else %>
  <!-- 一覧リスト -->
  <ul class="space-y-3 -mt-2">
    <% @pre_codes.each do |pc| %>
      <li>
        <%= link_to pc, class: "block border rounded-xl p-4 ring-slate-300 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300" do %>
          <div class="flex justify-between">
            <!-- 左：タイトル／説明 -->
            <div class="flex-1 pr-4">
              <!-- タイトル行 -->
              <div class="font-semibold flex items-center gap-2">
                <%= pc.title %>
                <% if pc.answer.present? %>
                  <span class="text-[10px] px-1.5 py-0.5 rounded bg-amber-200 text-amber-800">QUIZ</span>
                <% end %>
              </div>

              <!-- タグピル -->
              <div class="mt-2">
                <%= render "shared/tag_pills_static", record: pc %>
              </div>

              <!-- 説明文 -->
              <p class="text-sm text-slate-500 mt-2"><%= truncate(pc.description, length: 120) %></p>
            </div>

            <!-- 右：メトリクス表示 -->
            <div class="shrink-0">
              <%= render "code_libraries/metrics", pre_code: pc %>
            </div>
          </div>
        <% end %>
      </li>
    <% end %>
  </ul>

  <!-- ページネーション -->
  <div class="mt-6"><%= paginate @pre_codes %></div>
<% end %>
