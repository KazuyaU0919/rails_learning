<!-- =========================================================
  Page: プロフィール表示
  ---------------------------------------------------------
  ・現在ログイン中ユーザーの基本情報を一覧表示
  ・編集ページへの導線あり（右下「編集」ボタン）
  ・折りたたみの「🔰 初めての方へ」説明を内包
========================================================= -->

<!-- =======================
     パンくず & タイトル
     ======================= -->
<!-- パンくず -->
<% breadcrumb :profile %>
<%= render "shared/breadcrumbs" %>

<!-- <title> 用 -->
<% content_for :title, "プロフィール" %>

<div class="mx-auto w-full max-w-2xl space-y-3">
  <h1 class="text-xl font-semibold text-slate-900">プロフィール</h1>

  <!-- =========================================================
       🔰 初めての方へ（折りたたみ）
       - Stimulus controller: reveal を利用
  ========================================================= -->
  <section
    class="-mt-1"
    data-controller="reveal"
    data-reveal-open-label-value="🔰 初めての方へ"
    data-reveal-close-label-value="🔰 説明を閉じる">
    <div class="flex justify-end">
      <button type="button"
              class="btn-toggle"
              data-reveal-target="button"
              data-action="reveal#toggle">🔰 初めての方へ</button>
    </div>
    <div class="hidden mt-2" data-reveal-target="content">
      <pre class="whitespace-pre-wrap leading-relaxed text-slate-700 bg-white ring-1 ring-slate-200 rounded-xl p-4 text-[15px]">
👤 ユーザープロフィールへようこそ！！
ユーザープロフィールでは、My アカウントの確認と編集ができます。


編集可能な内容は、
アカウント名変更・パスワード変更・外部連携先の追加・他端末のログイン状態の解除の４つです。

※ メールアドレスはアカウントに紐づいて登録されておりますので、
　申し訳ありませんが、メールアドレスの変更はできません。
      </pre>
    </div>
  </section>

  <!-- =========================================================
       プロフィール詳細（読み取り専用）
       - ユーザー名 / メール / パスワード有無 / 外部連携 / 登録日 / 最終ログイン
  ========================================================= -->
  <div class="rounded-xl bg-white ring-1 ring-slate-200 divide-y divide-slate-100">
    <!-- ユーザー名 -->
    <div class="grid grid-cols-3 gap-4 px-4 py-3">
      <div class="text-sm text-slate-500">ユーザー名</div>
      <div class="col-span-2"><%= current_user.name %></div>
    </div>

    <!-- メール -->
    <div class="grid grid-cols-3 gap-4 px-4 py-3">
      <div class="text-sm text-slate-500">メール</div>
      <div class="col-span-2"><%= current_user.email %></div>
    </div>

    <!-- パスワード有無 -->
    <div class="grid grid-cols-3 gap-4 px-4 py-3">
      <div class="text-sm text-slate-500">パスワード</div>
      <div class="col-span-2">
        <% if current_user.has_password? %>
          <span>設定済み</span>
        <% else %>
          <span class="text-red-600 font-medium">パスワードが未設定です</span>
        <% end %>
      </div>
    </div>

    <!-- 外部連携状態（Google / GitHub） -->
    <div class="grid grid-cols-3 gap-4 px-4 py-3">
      <div class="text-sm text-slate-500">外部連携</div>
      <div class="col-span-2 flex flex-wrap gap-2">
        <% if current_user.authentications.exists?(provider: "google_oauth2") %>
          <span class="rounded-full bg-emerald-50 px-2.5 py-0.5 text-xs font-medium text-emerald-700 ring-1 ring-emerald-200">Google 接続済み</span>
        <% else %>
          <span class="rounded-full bg-slate-50 px-2.5 py-0.5 text-xs font-medium text-slate-600 ring-1 ring-slate-200">Google 未接続</span>
        <% end %>
        <% if current_user.authentications.exists?(provider: "github") %>
          <span class="rounded-full bg-emerald-50 px-2.5 py-0.5 text-xs font-medium text-emerald-700 ring-1 ring-emerald-200">GitHub 接続済み</span>
        <% else %>
          <span class="rounded-full bg-slate-50 px-2.5 py-0.5 text-xs font-medium text-slate-600 ring-1 ring-slate-200">GitHub 未接続</span>
        <% end %>
      </div>
    </div>

    <!-- 登録日 -->
    <div class="grid grid-cols-3 gap-4 px-4 py-3">
      <div class="text-sm text-slate-500">登録日</div>
      <div class="col-span-2"><%= l current_user.created_at, format: :ymd_hm %></div>
    </div>

    <!-- 最終ログイン -->
    <div class="grid grid-cols-3 gap-4 px-4 py-3">
      <div class="text-sm text-slate-500">最終ログイン</div>
      <div class="col-span-2"><%= current_user.last_login_at ? l(current_user.last_login_at, format: :ymd_hm) : "-" %></div>
    </div>
  </div>

  <!-- 編集ページへの導線 -->
  <div class="flex items-center justify-end">
    <%= link_to "編集", edit_profile_path, class: "btn-change is-edit" %>
  </div>
</div>
