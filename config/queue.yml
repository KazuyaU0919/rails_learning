# =========================================================
# File: config/queue.yml
# ---------------------------------------------------------
# 目的:
#   Solid Queue（Rails 8 標準ジョブキュー）の設定ファイル。
#   各環境でジョブのスレッド数・プロセス数・ポーリング間隔などを指定。
#
# ポイント:
#   - dispatchers: キュー監視ポーリング設定
#   - workers: 実際にジョブを処理するスレッド/プロセス設定
# =========================================================

default: &default
  dispatchers:
    - polling_interval: 1        # ジョブ取得間隔（秒）
      batch_size: 500            # 1回の取得件数
  workers:
    - queues: "*"                # 全てのキューを対象
      threads: 3                 # 1ワーカーあたりのスレッド数
      processes: <%= ENV.fetch("JOB_CONCURRENCY", 1) %>  # 並列プロセス数
      polling_interval: 0.1      # 次ジョブ取得までの間隔

development:
  <<: *default

test:
  <<: *default

production:
  <<: *default
